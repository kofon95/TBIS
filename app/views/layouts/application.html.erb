<!DOCTYPE html>
<html class="cool-scrollbar">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TBIS</title>
    <%= csrf_meta_tags %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%if Rails.env.production?%>
      <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <%else # development | test %>
      <%=javascript_include_tag 'vue'%>
    <%end%>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
    <script type="text/javascript" charset="utf-8">
Vue.config.productionTip = Vue.config.devtools = false;
const Routes = {
    getAllClients:    companyId => `/companies/${companyId}/clients.json`,
    getAllServices:   (companyId) => `/companies/${companyId}/services.json`,
    addNewClient:     companyId => `/companies/${companyId}/clients.json`,
    addNewService:    companyId => `/companies/${companyId}/services.json`,
    removeClient:     (companyId, clientId) => `/companies/${companyId}/clients/${clientId}.json`,
    removeService:    (companyId, serviceId) => `/companies/${companyId}/services/${serviceId}.json`,
    signIn:           () => '/auth/sign_in?return_url=' + encodeURIComponent(location.href),
    clientInfoWindow: () => '/windows/client-info',
    serviceInfoWindow:() => '/windows/service-info',
    addClientWindow:  () => '/windows/add-client',
    addServiceWindow: () => '/windows/add-service',
};
const AUTHENTICITY_TOKEN = document.querySelector('meta[name=csrf-token]').content
    </script>
  </head>

  <body data-params="<%=params.to_json%>" class="home">

    <div class="active-company">
      <% if signed_in? %>
        <div class="btn-show-list">
          <div class="name-company"><%= @current_company.name %></div>

          <div class="panel-show" style="width: 240px;">
            <%= link_to '+Добавить новою компанию', new_company_path, class: "add-discount" %>
            <div style="background-color: #e6eaed;">
                <div class="img-input" style="float: left;">
                  <%= image_tag s3_image(@current_people.avatar) %>
                  <%= Company.find(@current_people.company_id).name %>
                  <div style="font-size: 12px; color: darkgrey; margin-top: 5px;">
                    <%if (@current_people.role.to_i & Client::Role::CLIENT) > 0 %>
                      - Клиент
                    <%end %>
                    <% work = Work.where people_id: @current_people.id %>
                    <% work.each do |w| %>
                      - <%= t('position_work.' + w.position_work) %>
                    <% end %>
                  </div>
                </div>
              </div>
            <% @people_user = Client.where(user_id: current_user.id).where.not(id: @current_people.id) %>
            <% @people_user.each do |p| %>
              <%= link_to role_person_path(p.id), method: :post do %>
                <div class="img-input" style="float: left;">
                  <%= image_tag s3_image(p.avatar) %>
                  <%= Company.find(p.company_id).name %>
                  <div style="font-size: 12px; color: darkgrey; margin-top: 5px;">
                    <%if (p.role.to_i & Client::Role::CLIENT) > 0 %>
                      - Клиент
                    <%end %>
                    <% work = Work.where people_id: p.id %>
                    <% work.each do |w| %>
                      - <%= t('position_work.' + w.position_work) %>
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>

        <% work_director = Work.where people_id: @current_people.id, position_work: 'director' %>
        <% work_administrator = Work.where people_id: @current_people.id, position_work: 'administrator' %>
        <% if work_director.present? %>
          <div class="days-subs">356 дн.</div>
        <% end %>


        <% if work_director.present? or work_administrator.present? %>
          <div class="btn-show-list">
            <div class="btn-add-home">+Добавить</div>
            <div class="panel-show" style="width: 240px;">
              <%= link_to new_company_record_path(@current_company.id) do %>
                <img src="/images/group.png"><span>Группу</span>
              <% end %>
              <%= link_to new_company_client_path(@current_company.id) do %>
                <img src="/images/user.png"><span>Клиента</span>
              <% end %>
              <%= link_to new_company_worker_path(@current_company.id) do %>
                <img src="/images/teacher.png"><span>Сотрудника</span>
              <% end %>
              <%= link_to new_company_affiliate_path(@current_company.id) do %>
                <img src="/images/list.png"><span>Филиал</span>
              <% end %>
              <%= link_to new_company_service_path(@current_company.id) do %>
                <img src="/images/workflow.png"><span>Услугу</span>
              <% end %>
            </div>
          </div>
        <% end %>


      <% end %>
      <%if flash[:notice].present?%>
        <div class="message">
          <%= flash[:notice].html_safe %>
          <%=flash[:alert]%>
          <%=flash[:danger]%>
        </div>
      <%end%>
    </div>

    <% render 'layouts/open_tabs' %>

    <%if signed_in? and current_user.people_id %>
      <div class="current-object">
        <% client = Client.find current_user.people_id %>
        <%=link_to persons_profile_path do %>
          <%= image_tag s3_image(current_user.avatar), class: 'object-avatar' %>
        <% end %>
        <div class="object-info">
          <span class="name-people"><%="#{current_user.first_name} #{current_user.last_name}"%></span>
          <span class="roles-people"><%= corrent_role(client.role, '', ' ') %></span>
        </div>
        <%= link_to 'выход', destroy_user_session_path, method: :delete, class: "sign-out" %>
      </div>
    <%end%>
    
    <%=yield%>
    
    <div class="footer">
      <div class="other-sections">
        <div>О сервисе</div>
        <div>Поддержка</div>
        <div>Блог</div>
        <div>Новые функции</div>
        <div>Исправить или добавить функции</div>
        <div>Оставить отзыв</div>
        <div>Помощь по бизнесу</div>
      </div>
      <div class="copyright">© 2016 - 2018 Dreambox™ alpha</div>
    </div>
  
    <div class="back-background"></div>
  </body>
</html>
